{"version":3,"names":["React","useCallback","useEffect","useImperativeHandle","useRef","useState","View","Text","styles","BackgroundTimer","defaultProps","style","textStyle","onTimes","_seconds","onPause","onEnd","CountdownComponent","forwardRef","props","ref","initialSeconds","fontFamily","autoStart","formatTime","interval","hours","minute","seconds","currentSeconds","key","setKey","Math","random","start","pause","resume","stop","init","current","clear","timer","setInterval","clearInterval","font","renderTimer","text","toString","length"],"sources":["index.tsx"],"sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\n/* eslint-disable no-bitwise */\nimport React, {\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n} from 'react';\nimport { View, Text } from 'react-native';\nimport { styles } from './styles';\nimport type { CountDownProps } from './model';\nimport BackgroundTimer from 'react-native-background-timer';\n\nconst defaultProps = {\n  style: {},\n  textStyle: {},\n  onTimes: (_seconds: number) => {},\n  onPause: (_seconds: number) => {},\n  onEnd: (_seconds: number) => {},\n};\n\nconst CountdownComponent = React.forwardRef<any, CountDownProps>(\n  (props, ref) => {\n    const {\n      initialSeconds,\n      style,\n      textStyle,\n      fontFamily,\n      autoStart = false,\n      formatTime = 'hh:mm:ss',\n      onEnd,\n      onTimes,\n      onPause,\n    } = props;\n\n    const interval = useRef(0);\n    const hours = useRef(0);\n    const minute = useRef(0);\n    const seconds = useRef(0);\n    const currentSeconds = useRef(0);\n\n    const [key, setKey] = useState(Math.random());\n\n    useImperativeHandle(ref, () => {\n      return { start, pause, resume, stop };\n    });\n\n    const init = useCallback(() => {\n      if (initialSeconds) {\n        currentSeconds.current = initialSeconds;\n        hours.current = ~~(currentSeconds.current / 3600);\n        minute.current = ~~((currentSeconds.current % 3600) / 60);\n        seconds.current = ~~currentSeconds.current % 60;\n      }\n      setKey(Math.random());\n    }, [initialSeconds]);\n\n    const pause = useCallback(() => {\n      if (onPause) {\n        onPause(currentSeconds.current);\n      }\n      clear();\n    }, []);\n\n    const resume = () => {\n      if (!interval.current) {\n        timer();\n      }\n    };\n\n    const stop = () => {\n      if (onEnd) {\n        onEnd(currentSeconds.current);\n      }\n\n      init();\n      clear();\n    };\n\n    useEffect(() => {\n      init();\n    }, [initialSeconds]);\n\n    useEffect(() => {\n      return () => {\n        pause();\n      };\n    }, []);\n\n    useEffect(() => {\n      if (autoStart) {\n        start();\n      }\n    }, [autoStart]);\n\n    const timer = useCallback(() => {\n      interval.current = BackgroundTimer.setInterval(() => {\n        if (currentSeconds.current > 0) {\n          currentSeconds.current = currentSeconds.current - 1;\n          hours.current = ~~(currentSeconds.current / 3600);\n          minute.current = ~~((currentSeconds.current % 3600) / 60);\n          seconds.current = ~~currentSeconds.current % 60;\n\n          if (onTimes) {\n            onTimes(currentSeconds.current);\n          }\n        }\n        if (currentSeconds.current <= 0) {\n          if (onEnd) {\n            onEnd(currentSeconds.current);\n          }\n          clear();\n        }\n        setKey(Math.random());\n      }, 1000);\n    }, []);\n\n    const start = useCallback(() => {\n      init();\n\n      if (!interval.current) {\n        timer();\n      }\n    }, []);\n\n    const clear = () => {\n      if (interval.current) {\n        BackgroundTimer.clearInterval(interval.current);\n        interval.current = 0;\n      }\n    };\n\n    const font = () => {\n      if (fontFamily) {\n        return {\n          fontFamily: fontFamily,\n        };\n      } else {\n        return {};\n      }\n    };\n\n    const renderTimer = () => {\n      if (formatTime === 'hh:mm:ss') {\n        if (hours.current > 0) {\n          return (\n            <Text style={[styles.text, textStyle, font()]}>{`${hours.current}:${\n              minute.current.toString().length === 1 ? '0' : ''\n            }${minute.current}:${\n              seconds.current.toString().length === 1 ? '0' : ''\n            }${seconds.current}`}</Text>\n          );\n        } else {\n          if (minute.current > 0) {\n            return (\n              <Text style={[styles.text, textStyle, font()]}>{`${\n                minute.current\n              }:${seconds.current.toString().length === 1 ? '0' : ''}${\n                seconds.current\n              }`}</Text>\n            );\n          } else {\n            return (\n              <Text\n                style={[styles.text, textStyle, font()]}\n              >{`${seconds.current}`}</Text>\n            );\n          }\n        }\n      } else {\n        return (\n          <Text\n            style={[styles.text, textStyle, font()]}\n          >{`${currentSeconds.current}`}</Text>\n        );\n      }\n    };\n\n    return (\n      <View style={style} key={key}>\n        {renderTimer()}\n      </View>\n    );\n  }\n);\n\nCountdownComponent.defaultProps = defaultProps;\n\nexport default CountdownComponent;\n"],"mappings":"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"}